{"version":3,"file":"index.js","mappings":"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","sources":["webpack://supersetEmbeddedSdk/webpack/universalModuleDefinition","webpack://supersetEmbeddedSdk/webpack/bootstrap","webpack://supersetEmbeddedSdk/webpack/runtime/define property getters","webpack://supersetEmbeddedSdk/webpack/runtime/hasOwnProperty shorthand","webpack://supersetEmbeddedSdk/webpack/runtime/make namespace object","webpack://supersetEmbeddedSdk/./src/const.ts","webpack://supersetEmbeddedSdk/./node_modules/@superset-ui/switchboard/esm/switchboard.js","webpack://supersetEmbeddedSdk/./node_modules/jwt-decode/build/esm/index.js","webpack://supersetEmbeddedSdk/./src/guestTokenRefresh.ts","webpack://supersetEmbeddedSdk/./src/index.ts"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"supersetEmbeddedSdk\"] = factory();\n\telse\n\t\troot[\"supersetEmbeddedSdk\"] = factory();\n})(globalThis, () => {\nreturn ","// The require scope\nvar __webpack_require__ = {};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nexport const IFRAME_COMMS_MESSAGE_TYPE = \"__embedded_comms__\";\nexport const DASHBOARD_UI_FILTER_CONFIG_URL_PARAM_KEY: { [index: string]: any } = {\n  visible: \"show_filters\",\n  expanded: \"expand_filters\",\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\n\n\n\n\n\n\n// Each message we send on the channel specifies an action we want the other side to cooperate with.\nvar Actions = /*#__PURE__*/function (Actions) {Actions[\"GET\"] = \"get\";Actions[\"REPLY\"] = \"reply\";Actions[\"EMIT\"] = \"emit\";Actions[\"ERROR\"] = \"error\";return Actions;}(Actions || {});\n\n\n\n\n\n\n\n\n// helper types/functions for making sure wires don't get crossed\n\n\n\n\n\n\n\n\n\n\n\n\nfunction isGet(message) {\n  return message.switchboardAction === Actions.GET;\n}\n\n\n\n\n\n\n\nfunction isReply(message) {\n  return message.switchboardAction === Actions.REPLY;\n}\n\n\n\n\n\n\n\nfunction isEmit(message) {\n  return message.switchboardAction === Actions.EMIT;\n}\n\n\n\n\n\n\n\nfunction isError(message) {\n  return message.switchboardAction === Actions.ERROR;\n}\n\n/**\n * A utility for communications between an iframe and its parent, used by the Superset embedded SDK.\n * This builds useful patterns on top of the basic functionality offered by MessageChannel.\n *\n * Both windows instantiate a Switchboard, passing in their MessagePorts.\n * Calling methods on the switchboard causes messages to be sent through the channel.\n */\nexport class Switchboard {\n\n\n\n\n\n\n\n\n\n\n\n\n\n  constructor(params) {this.port = void 0;this.name = '';this.methods = {}; // used to make unique ids\n    this.incrementor = 1;this.debugMode = void 0;this.isInitialised = void 0;if (!params) {\n      return;\n    }\n    this.init(params);\n  }\n\n  init(params) {\n    if (this.isInitialised) {\n      this.logError('already initialized');\n      return;\n    }\n\n    const { port, name = 'switchboard', debug = false } = params;\n\n    this.port = port;\n    this.name = name;\n    this.debugMode = debug;\n\n    port.addEventListener('message', async (event) => {\n      this.log('message received', event);\n      const message = event.data;\n      if (isGet(message)) {\n        // find the method, call it, and reply with the result\n        this.port.postMessage(await this.getMethodResult(message));\n      } else if (isEmit(message)) {\n        const { method, args } = message;\n        // Find the method and call it, but no result necessary.\n        // Should this multicast to a set of listeners?\n        // Maybe, but that requires writing a bunch more code\n        // and I haven't found a need for it yet.\n        const executor = this.methods[method];\n        if (executor) {\n          executor(args);\n        }\n      }\n    });\n\n    this.isInitialised = true;\n  }\n\n  async getMethodResult({\n    messageId,\n    method,\n    args\n  }) {\n    const executor = this.methods[method];\n    if (executor == null) {\n      return {\n        switchboardAction: Actions.ERROR,\n        messageId,\n        error: `[${this.name}] Method \"${method}\" is not defined`\n      };\n    }\n    try {\n      const result = await executor(args);\n      return {\n        switchboardAction: Actions.REPLY,\n        messageId,\n        result\n      };\n    } catch (err) {\n      this.logError(err);\n      return {\n        switchboardAction: Actions.ERROR,\n        messageId,\n        error: `[${this.name}] Method \"${method}\" threw an error`\n      };\n    }\n  }\n\n  /**\n   * Defines a method that can be \"called\" from the other side by sending an event.\n   */\n  defineMethod(\n  methodName,\n  executor)\n  {\n    this.methods[methodName] = executor;\n  }\n\n  /**\n   * Calls a method registered on the other side, and returns the result.\n   *\n   * How this is accomplished:\n   * This switchboard sends a \"get\" message over the channel describing which method to call with which arguments.\n   * The other side's switchboard finds a method with that name, and calls it with the arguments.\n   * It then packages up the returned value into a \"reply\" message, sending it back to us across the channel.\n   * This switchboard has attached a listener on the channel, which will resolve with the result when a reply is detected.\n   *\n   * Instead of an arguments list, arguments are supplied as a map.\n   *\n   * @param method the name of the method to call\n   * @param args arguments that will be supplied. Must be serializable, no functions or other nonsense.\n   * @returns whatever is returned from the method\n   */\n  get(method, args = undefined) {\n    return new Promise((resolve, reject) => {\n      if (!this.isInitialised) {\n        reject(new Error('Switchboard not initialised'));\n        return;\n      }\n      // In order to \"call a method\" on the other side of the port,\n      // we will send a message with a unique id\n      const messageId = this.getNewMessageId();\n      // attach a new listener to our port, and remove it when we get a response\n      const listener = (event) => {\n        const message = event.data;\n        if (message.messageId !== messageId) return;\n        this.port.removeEventListener('message', listener);\n        if (isReply(message)) {\n          resolve(message.result);\n        } else {\n          const errStr = isError(message) ?\n          message.error :\n          'Unexpected response message';\n          reject(new Error(errStr));\n        }\n      };\n      this.port.addEventListener('message', listener);\n      this.port.start();\n      const message = {\n        switchboardAction: Actions.GET,\n        method,\n        messageId,\n        args\n      };\n      this.port.postMessage(message);\n    });\n  }\n\n  /**\n   * Emit calls a method on the other side just like get does.\n   * But emit doesn't wait for a response, it just sends and forgets.\n   *\n   * @param method\n   * @param args\n   */\n  emit(method, args = undefined) {\n    if (!this.isInitialised) {\n      this.logError('Switchboard not initialised');\n      return;\n    }\n    const message = {\n      switchboardAction: Actions.EMIT,\n      method,\n      args\n    };\n    this.port.postMessage(message);\n  }\n\n  start() {\n    if (!this.isInitialised) {\n      this.logError('Switchboard not initialised');\n      return;\n    }\n    this.port.start();\n  }\n\n  log(...args) {\n    if (this.debugMode) {\n      console.debug(`[${this.name}]`, ...args);\n    }\n  }\n\n  logError(...args) {\n    console.error(`[${this.name}]`, ...args);\n  }\n\n  getNewMessageId() {\n    // eslint-disable-next-line no-plusplus\n    return `m_${this.name}_${this.incrementor++}`;\n  }\n}\n\nexport default new Switchboard();\n//# sourceMappingURL=switchboard.js.map","export class InvalidTokenError extends Error {\n}\nInvalidTokenError.prototype.name = \"InvalidTokenError\";\nfunction b64DecodeUnicode(str) {\n    return decodeURIComponent(atob(str).replace(/(.)/g, (m, p) => {\n        let code = p.charCodeAt(0).toString(16).toUpperCase();\n        if (code.length < 2) {\n            code = \"0\" + code;\n        }\n        return \"%\" + code;\n    }));\n}\nfunction base64UrlDecode(str) {\n    let output = str.replace(/-/g, \"+\").replace(/_/g, \"/\");\n    switch (output.length % 4) {\n        case 0:\n            break;\n        case 2:\n            output += \"==\";\n            break;\n        case 3:\n            output += \"=\";\n            break;\n        default:\n            throw new Error(\"base64 string is not of the correct length\");\n    }\n    try {\n        return b64DecodeUnicode(output);\n    }\n    catch (err) {\n        return atob(output);\n    }\n}\nexport function jwtDecode(token, options) {\n    if (typeof token !== \"string\") {\n        throw new InvalidTokenError(\"Invalid token specified: must be a string\");\n    }\n    options || (options = {});\n    const pos = options.header === true ? 0 : 1;\n    const part = token.split(\".\")[pos];\n    if (typeof part !== \"string\") {\n        throw new InvalidTokenError(`Invalid token specified: missing part #${pos + 1}`);\n    }\n    let decoded;\n    try {\n        decoded = base64UrlDecode(part);\n    }\n    catch (e) {\n        throw new InvalidTokenError(`Invalid token specified: invalid base64 for part #${pos + 1} (${e.message})`);\n    }\n    try {\n        return JSON.parse(decoded);\n    }\n    catch (e) {\n        throw new InvalidTokenError(`Invalid token specified: invalid json for part #${pos + 1} (${e.message})`);\n    }\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { jwtDecode } from \"jwt-decode\";\n\nexport const REFRESH_TIMING_BUFFER_MS = 5000 // refresh guest token early to avoid failed superset requests\nexport const MIN_REFRESH_WAIT_MS = 10000 // avoid blasting requests as fast as the cpu can handle\nexport const DEFAULT_TOKEN_EXP_MS = 300000 // (5 min) used only when parsing guest token exp fails\n\n// when do we refresh the guest token?\nexport function getGuestTokenRefreshTiming(currentGuestToken: string) {\n  const parsedJwt = jwtDecode<Record<string, any>>(currentGuestToken);\n  // if exp is int, it is in seconds, but Date() takes milliseconds\n  const exp = new Date(/[^0-9\\.]/g.test(parsedJwt.exp) ? parsedJwt.exp : parseFloat(parsedJwt.exp) * 1000);\n  const isValidDate = exp.toString() !== 'Invalid Date';\n  const ttl = isValidDate ? Math.max(MIN_REFRESH_WAIT_MS, exp.getTime() - Date.now()) : DEFAULT_TOKEN_EXP_MS;\n  return ttl - REFRESH_TIMING_BUFFER_MS;\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport {\n  DASHBOARD_UI_FILTER_CONFIG_URL_PARAM_KEY,\n  IFRAME_COMMS_MESSAGE_TYPE\n} from './const';\n\n// We can swap this out for the actual switchboard package once it gets published\nimport { Switchboard } from '@superset-ui/switchboard';\nimport { getGuestTokenRefreshTiming } from './guestTokenRefresh';\n\n/**\n * The function to fetch a guest token from your Host App's backend server.\n * The Host App backend must supply an API endpoint\n * which returns a guest token with appropriate resource access.\n */\nexport type GuestTokenFetchFn = () => Promise<string>;\n\nexport type UiConfigType = {\n  hideTitle?: boolean\n  hideTab?: boolean\n  hideChartControls?: boolean\n  filters?: {\n    [key: string]: boolean | undefined\n    visible?: boolean\n    expanded?: boolean\n  }\n  urlParams?: {\n    [key: string]: any\n  }\n}\n\nexport type EmbedDashboardParams = {\n  /** The id provided by the embed configuration UI in Superset */\n  id: string\n  /** The domain where Superset can be located, with protocol, such as: https://superset.example.com */\n  supersetDomain: string\n  /** The html element within which to mount the iframe */\n  mountPoint: HTMLElement\n  /** A function to fetch a guest token from the Host App's backend server */\n  fetchGuestToken: GuestTokenFetchFn\n  /** The dashboard UI config: hideTitle, hideTab, hideChartControls, filters.visible, filters.expanded **/\n  dashboardUiConfig?: UiConfigType\n  /** Are we in debug mode? */\n  debug?: boolean\n  /** The iframe title attribute */\n  iframeTitle?: string\n  /** additional iframe sandbox attributes ex (allow-top-navigation, allow-popups-to-escape-sandbox) **/\n  iframeSandboxExtras?: string[]\n}\n\nexport type Size = {\n  width: number, height: number\n}\n\nexport type EmbeddedDashboard = {\n  getScrollSize: () => Promise<Size>\n  unmount: () => void\n  getDashboardPermalink: (anchor: string) => Promise<string>\n  getActiveTabs: () => Promise<string[]>\n}\n\n/**\n * Embeds a Superset dashboard into the page using an iframe.\n */\nexport async function embedDashboard({\n  id,\n  supersetDomain,\n  mountPoint,\n  fetchGuestToken,\n  dashboardUiConfig,\n  debug = false,\n  iframeTitle = \"Embedded Dashboard\",\n  iframeSandboxExtras = []\n}: EmbedDashboardParams): Promise<EmbeddedDashboard> {\n  function log(...info: unknown[]) {\n    if (debug) {\n      console.debug(`[superset-embedded-sdk][dashboard ${id}]`, ...info);\n    }\n  }\n\n  log('embedding');\n\n  if (supersetDomain.endsWith(\"/\")) {\n    supersetDomain = supersetDomain.slice(0, -1);\n  }\n\n  function calculateConfig() {\n    let configNumber = 0\n    if(dashboardUiConfig) {\n      if(dashboardUiConfig.hideTitle) {\n        configNumber += 1\n      }\n      if(dashboardUiConfig.hideTab) {\n        configNumber += 2\n      }\n      if(dashboardUiConfig.hideChartControls) {\n        configNumber += 8\n      }\n    }\n    return configNumber\n  }\n\n  async function mountIframe(): Promise<Switchboard> {\n    return new Promise(resolve => {\n      const iframe = document.createElement('iframe');\n      const dashboardConfigUrlParams = dashboardUiConfig ? {uiConfig: `${calculateConfig()}`} : undefined;\n      const filterConfig = dashboardUiConfig?.filters || {}\n      const filterConfigKeys = Object.keys(filterConfig)\n      const filterConfigUrlParams = Object.fromEntries(filterConfigKeys.map(\n        key => [DASHBOARD_UI_FILTER_CONFIG_URL_PARAM_KEY[key], filterConfig[key]]))\n\n      // Allow url query parameters from dashboardUiConfig.urlParams to override the ones from filterConfig\n      const urlParams = {...dashboardConfigUrlParams, ...filterConfigUrlParams, ...dashboardUiConfig?.urlParams}\n      const urlParamsString = Object.keys(urlParams).length ? '?' + new URLSearchParams(urlParams).toString() : ''\n\n      // set up the iframe's sandbox configuration\n      iframe.sandbox.add(\"allow-same-origin\"); // needed for postMessage to work\n      iframe.sandbox.add(\"allow-scripts\"); // obviously the iframe needs scripts\n      iframe.sandbox.add(\"allow-presentation\"); // for fullscreen charts\n      iframe.sandbox.add(\"allow-downloads\"); // for downloading charts as image\n      iframe.sandbox.add(\"allow-forms\"); // for forms to submit\n      iframe.sandbox.add(\"allow-popups\"); // for exporting charts as csv\n      // additional sandbox props\n      iframeSandboxExtras.forEach((key: string) => {\n        iframe.sandbox.add(key);\n      });\n\n      // add the event listener before setting src, to be 100% sure that we capture the load event\n      iframe.addEventListener('load', () => {\n        // MessageChannel allows us to send and receive messages smoothly between our window and the iframe\n        // See https://developer.mozilla.org/en-US/docs/Web/API/Channel_Messaging_API\n        const commsChannel = new MessageChannel();\n        const ourPort = commsChannel.port1;\n        const theirPort = commsChannel.port2;\n\n        // Send one of the message channel ports to the iframe to initialize embedded comms\n        // See https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage\n        // we know the content window isn't null because we are in the load event handler.\n        iframe.contentWindow!.postMessage(\n          { type: IFRAME_COMMS_MESSAGE_TYPE, handshake: \"port transfer\" },\n          supersetDomain,\n          [theirPort],\n        )\n        log('sent message channel to the iframe');\n\n        // return our port from the promise\n        resolve(new Switchboard({ port: ourPort, name: 'superset-embedded-sdk', debug }));\n      });\n      iframe.src = `${supersetDomain}/embedded/${id}${urlParamsString}`;\n      iframe.title = iframeTitle;\n      //@ts-ignore\n      mountPoint.replaceChildren(iframe);\n      log('placed the iframe')\n    });\n  }\n\n  const [guestToken, ourPort]: [string, Switchboard] = await Promise.all([\n    fetchGuestToken(),\n    mountIframe(),\n  ]);\n\n  ourPort.emit('guestToken', { guestToken });\n  log('sent guest token');\n\n  async function refreshGuestToken() {\n    const newGuestToken = await fetchGuestToken();\n    ourPort.emit('guestToken', { guestToken: newGuestToken });\n    setTimeout(refreshGuestToken, getGuestTokenRefreshTiming(newGuestToken));\n  }\n\n  setTimeout(refreshGuestToken, getGuestTokenRefreshTiming(guestToken));\n\n  function unmount() {\n    log('unmounting');\n    //@ts-ignore\n    mountPoint.replaceChildren();\n  }\n\n  const getScrollSize = () => ourPort.get<Size>('getScrollSize');\n  const getDashboardPermalink = (anchor: string) =>\n    ourPort.get<string>('getDashboardPermalink', { anchor });\n  const getActiveTabs = () => ourPort.get<string[]>('getActiveTabs')\n\n  return {\n    getScrollSize,\n    unmount,\n    getDashboardPermalink,\n    getActiveTabs,\n  };\n}\n"],"names":["root","factory","exports","module","define","amd","globalThis","__webpack_require__","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","IFRAME_COMMS_MESSAGE_TYPE","DASHBOARD_UI_FILTER_CONFIG_URL_PARAM_KEY","visible","expanded","Actions","Switchboard","constructor","params","this","port","name","methods","incrementor","debugMode","isInitialised","init","logError","debug","addEventListener","async","event","log","message","data","switchboardAction","GET","isGet","postMessage","getMethodResult","EMIT","isEmit","method","args","executor","messageId","ERROR","error","result","REPLY","err","defineMethod","methodName","undefined","Promise","resolve","reject","Error","getNewMessageId","listener","removeEventListener","isReply","errStr","isError","start","emit","console","InvalidTokenError","REFRESH_TIMING_BUFFER_MS","MIN_REFRESH_WAIT_MS","DEFAULT_TOKEN_EXP_MS","getGuestTokenRefreshTiming","currentGuestToken","parsedJwt","token","options","pos","header","part","split","decoded","str","output","replace","length","decodeURIComponent","atob","m","p","code","charCodeAt","toString","toUpperCase","b64DecodeUnicode","base64UrlDecode","e","JSON","parse","jwtDecode","exp","Date","test","parseFloat","Math","max","getTime","now","embedDashboard","id","supersetDomain","mountPoint","fetchGuestToken","dashboardUiConfig","iframeTitle","iframeSandboxExtras","info","calculateConfig","configNumber","hideTitle","hideTab","hideChartControls","endsWith","slice","guestToken","ourPort","all","iframe","document","createElement","dashboardConfigUrlParams","uiConfig","filterConfig","filters","filterConfigKeys","keys","urlParams","fromEntries","map","urlParamsString","URLSearchParams","sandbox","add","forEach","commsChannel","MessageChannel","port1","theirPort","port2","contentWindow","type","handshake","src","title","replaceChildren","mountIframe","setTimeout","refreshGuestToken","newGuestToken","getScrollSize","unmount","getDashboardPermalink","anchor","getActiveTabs"],"sourceRoot":""}